<div class="container">
  <div class="form-container">
    <h5 class="ha-title">Reporte Conceptos Mensuales</h5>
    <hr>

    <form [formGroup]="formularioConceptosMensuales" class="ha-form">
      <div class="form-content">
        <!-- Formulario Visible 2 -->
        <div *ngIf="formularioVisible2" class="form-section">
          <div class="p-field-group">
            <div class="p-field calendar-field">
              <p-calendar 
              formControlName="date"
              [iconDisplay]="'input'" 
              [showIcon]="true" 
              dateFormat="yy-mm-dd"
              placeholder="Ingrese Fecha"
               />

            </div>
            <div class="button-container">
              <!-- Botón para Buscar -->
              <p-button severity="primary" label="" icon="pi pi-search" (click)="loadDataCM()" type="submit" ></p-button>
              <!-- Botón para cancelar -->
              <p-button severity="danger" label="" icon="pi pi-times" (click)="ocultarFormulario2()"></p-button>
            </div>
          </div>
          <hr class="section-divider">
        </div>

        <!-- Formulario Visible -->
        <div *ngIf="formularioVisible" class="form-section">
          <div class="button-container">
            <!-- Botón para Exportar a Excel -->
            <!-- <p-button severity="success" label="Generar EXCEL" icon="pi pi-file-pdf" (click)="exportarPDF2()"></p-button> -->
            <p-button severity="danger" label="Generar PDF" icon="pi pi-file-pdf" (click)="exportarPDF2()"></p-button>
            <!-- <p-button severity="danger" label="Generar PDF" icon="pi pi-file-pdf" (click)="exportarPDF2()"></p-button> -->
          </div>
          <hr class="section-divider">
        </div>

        <!-- Tabla de Datos -->
        <div *ngIf="formularioVisible2" class="table-container">
          <p-table
            #tbHistorial
            [globalFilterFields]="['CAJA_TRAN',	'EMISION',	'TITCRED',	'CONTRIBUYENTE', 'NTRAN']"
            [value]="recaudaciones"
            styleClass="p-datatable-striped"
            dataKey="CAJA_TRAN"
            [paginator]="true"
            [rows]="10"
          >
            <ng-template pTemplate="caption">
              <p-iconField iconPosition="left">
                <p-inputIcon class="input-icon">
                  <i class="pi pi-search"></i>
                </p-inputIcon>
                <input
                  pInputText
                  type="text"
                  (input)="applyFilterGlobal($event)"
                  (keydown.enter)="$event.preventDefault()"
                  placeholder="Buscar en tabla"
                  class="input-text p-inputtext buscar_cm_diario"
                />
              </p-iconField>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="UBICACION">
                  <span style="display: flex; align-items: center; gap: 5px;">
                    Ubicación <p-sortIcon field="UBICACION"></p-sortIcon>
                  </span>
                </th>
                <th pSortableColumn="CAJA_TRAN">
                  <span style="display: flex; align-items: center; gap: 5px;">
                    Transac <p-sortIcon field="CAJA_TRAN"></p-sortIcon>
                  </span>
                </th>
                <th pSortableColumn="EMISION">
                  <span style="display: flex; align-items: center; gap: 5px;">
                    Emi <p-sortIcon field="EMISION"></p-sortIcon>
                  </span>
                </th>
                <th pSortableColumn="TITCRED">
                  <span style="display: flex; align-items: center; gap: 5px;">
                    TitCred <p-sortIcon field="TITCRED"></p-sortIcon>
                  </span>
                </th>
                <!-- <th pSortableColumn="CEDULA">Cédula</th> -->
                <th pSortableColumn="CONTRIBUYENTE">
                  <span style="display: flex; align-items: center; gap: 5px;">
                    Contrib <p-sortIcon field="CONTRIBUYENTE"></p-sortIcon>
                  </span>
                </th>
                <th pSortableColumn="CONCEPTO">
                  <span style="display: flex; align-items: center; gap: 5px;">
                    Nom <p-sortIcon field="CONCEPTO"></p-sortIcon>
                  </span>
                </th>
                <th pSortableColumn="INTERES">
                  <span style="display: flex; align-items: center; gap: 5px;">
                    (+)Int <p-sortIcon field="INTERES"></p-sortIcon>
                  </span>
                </th>
                <th pSortableColumn="COACTIVA">
                  <span style="display: flex; align-items: center; gap: 5px;">
                    Coac <p-sortIcon field="COACTIVA"></p-sortIcon>
                  </span>
                </th>
                <th pSortableColumn="DESCUENTO" style="width: 4%;">
                  <span style="display: flex; align-items: center; gap: 5px;">
                    (-)Desc <p-sortIcon field="DESCUENTO"></p-sortIcon>
                  </span>
                </th>
                <th pSortableColumn="TOTAL" style="width: 4%;">
                  <span style="display: flex; align-items: center; gap: 5px;">
                    Total <p-sortIcon field="TOTAL"></p-sortIcon>
                  </span>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-recaudacion>
              <tr>
                <td>{{ recaudacion.UBICACION }}</td>
                <td>{{ recaudacion.CAJA_TRAN }}</td>
                <td>{{ recaudacion.EMISION }}</td>
                <td>{{ recaudacion.TITCRED }}</td>
                <!-- <td>{{ recaudacion.CEDULA }}</td> -->
                <td>{{ recaudacion.CONTRIBUYENTE }}</td>
                <td class="text-right">{{ recaudacion.CONCEPTO | number:'1.2-2' }}</td>
                <td class="text-right">{{ recaudacion.INTERES | number:'1.2-2' }}</td>
                <td class="text-right">{{ recaudacion.COACTIVA | number:'1.2-2' }}</td>
                <td class="text-right">{{ recaudacion.DESCUENTO | number:'1.2-2' }}</td>
                <td class="text-right">{{ recaudacion.TOTAL | number:'1.2-2' }}</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="summary">
              <div class="flex align-items-center justify-content-between">
                Total de registros {{ recaudaciones ? recaudaciones.length : 0 }}.
              </div>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="10">No se encontraron usuarios.</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </form>
  </div>
</div>
